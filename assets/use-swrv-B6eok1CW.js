import{I as J,r as U,q as $,o as N,a as Q,w as X,J as Y,K as Z}from"./index-CowSbynL.js";var x=new WeakMap,W=0;function ee(r){if(!r.length)return"";for(var n="arg",t=0;t<r.length;++t){var i=void 0;r[t]===null||typeof r[t]!="object"&&typeof r[t]!="function"?typeof r[t]=="string"?i='"'+r[t]+'"':i=String(r[t]):x.has(r[t])?i=x.get(r[t]):(i=W,x.set(r[t],W++)),n+="@"+i}return n}function te(r){if(typeof r=="function")try{r=r()}catch{r=""}return Array.isArray(r)?r=ee(r):r=String(r||""),r}var j=function(){function r(n){n===void 0&&(n=0),this.items=new Map,this.ttl=n}return r.prototype.serializeKey=function(n){return te(n)},r.prototype.get=function(n){var t=this.serializeKey(n);return this.items.get(t)},r.prototype.set=function(n,t,i){var a=this.serializeKey(n),e=i||this.ttl,o=Date.now(),c={data:t,createdAt:o,expiresAt:e?o+e:1/0};this.dispatchExpire(e,c,a),this.items.set(a,c)},r.prototype.dispatchExpire=function(n,t,i){var a=this;n&&setTimeout(function(){var e=Date.now(),o=e>=t.expiresAt;o&&a.delete(i)},n)},r.prototype.delete=function(n){this.items.delete(n)},r}();function re(){return typeof navigator.onLine<"u"?navigator.onLine:!0}function ne(){return typeof document<"u"&&typeof document.visibilityState<"u"?document.visibilityState!=="hidden":!0}var ie=function(r){return fetch(r).then(function(n){return n.json()})};const L={isOnline:re,isDocumentVisible:ne,fetcher:ie};var b=function(){return b=Object.assign||function(r){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r},b.apply(this,arguments)},R=function(r,n,t,i){function a(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function c(f){try{u(i.next(f))}catch(y){o(y)}}function d(f){try{u(i.throw(f))}catch(y){o(y)}}function u(f){f.done?e(f.value):a(f.value).then(c,d)}u((i=i.apply(r,n||[])).next())})},E=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,o;return o={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function c(u){return function(f){return d([u,f])}}function d(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,a&&(e=u[0]&2?a.return:u[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,u[1])).done)return e;switch(a=0,e&&(u=[u[0]&2,e.value]),u[0]){case 0:case 1:e=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!e||u[1]>e[0]&&u[1]<e[3])){t.label=u[1];break}if(u[0]===6&&t.label<e[1]){t.label=e[1],e=u;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(u);break}e[2]&&t.ops.pop(),t.trys.pop();continue}u=n.call(r,t)}catch(f){u=[6,f],a=0}finally{i=e=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},ae=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),a,e=[],o;try{for(;(n===void 0||n-- >0)&&!(a=i.next()).done;)e.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return e},ue=function(r,n,t){if(t||arguments.length===2)for(var i=0,a=n.length,e;i<a;i++)(e||!(i in n))&&(e||(e=Array.prototype.slice.call(n,0,i)),e[i]=n[i]);return r.concat(e||Array.prototype.slice.call(n))},P=new j,O=new j,F=new j,q={cache:P,refreshInterval:0,ttl:0,serverTTL:1e3,dedupingInterval:2e3,revalidateOnFocus:!0,revalidateDebounce:0,shouldRetryOnError:!0,errorRetryInterval:5e3,errorRetryCount:5,fetcher:L.fetcher,isOnline:L.isOnline,isDocumentVisible:L.isDocumentVisible};function oe(r,n,t){var i=O.get(r);if(i)i.data.push(n);else{var a=5e3;O.set(r,[n],t>0?t+a:t)}}function fe(r,n,t){if(t.isDocumentVisible()&&!(t.errorRetryCount!==void 0&&n>t.errorRetryCount)){var i=Math.min(n||0,t.errorRetryCount),a=i*t.errorRetryInterval;setTimeout(function(){r(null,{errorRetryCount:i+1,shouldRetryOnError:!0})},a)}}var B=function(r,n,t,i){return t===void 0&&(t=P),i===void 0&&(i=q.ttl),R(void 0,void 0,void 0,function(){var a,e,o,c,d,u,f;return E(this,function(y){switch(y.label){case 0:if(!le(n))return[3,5];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,n];case 2:return a=y.sent(),[3,4];case 3:return c=y.sent(),e=c,[3,4];case 4:return[3,6];case 5:a=n,y.label=6;case 6:if(o=!1,d={data:a,error:e,isValidating:o},typeof a<"u")try{t.set(r,d,i)}catch(h){console.error("swrv(mutate): failed to set cache",h)}return u=O.get(r),u&&u.data.length&&(f=u.data.filter(function(h){return h.key===r}),f.forEach(function(h,s){typeof d.data<"u"&&(h.data=d.data),h.error=d.error,h.isValidating=d.isValidating;var g=s===f.length-1;g||delete f[s]}),f=f.filter(Boolean)),[2,d]}})})};function ce(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var i,a,e=b({},q),o=!1,c=!1,d=J(),u=(d==null?void 0:d.proxy)||d;if(!u)return console.error("Could not get current instance, check to make sure that `useSwrv` is declared in the top level of the setup function."),null;var f=(u==null?void 0:u.$isServer)||!1;n.length>=1&&(i=n[0]),n.length>=2&&(a=n[1]),n.length>2&&(e=b(b({},e),n[2]));var y=f?e.serverTTL:e.ttl,h=typeof i=="function"?i:U(i);typeof a>"u"&&(a=e.fetcher);var s=null;s||(s=$({data:void 0,error:void 0,isValidating:!0,key:null}));var g=function(v,l){return R(r,void 0,void 0,function(){var k,m,C,V,S,K,D,M=this;return E(this,function(T){switch(T.label){case 0:return k=s.data===void 0,m=h.value,m?(C=e.cache.get(m),V=C&&C.data,s.isValidating=!0,V&&(s.data=V.data,s.error=V.error),S=v||a,!S||!e.isDocumentVisible()&&!k||(l==null?void 0:l.forceRevalidate)!==void 0&&!(l!=null&&l.forceRevalidate)?(s.isValidating=!1,[2]):C&&(K=!!(Date.now()-C.createdAt>=e.dedupingInterval||l!=null&&l.forceRevalidate),!K)?(s.isValidating=!1,[2]):(D=function(){return R(M,void 0,void 0,function(){var w,z,_,H;return E(this,function(I){switch(I.label){case 0:return w=F.get(m),w?[3,2]:(z=Array.isArray(m)?m:[m],_=S.apply(void 0,ue([],ae(z),!1)),F.set(m,_,e.dedupingInterval),[4,B(m,_,e.cache,y)]);case 1:return I.sent(),[3,4];case 2:return[4,B(m,w.data,e.cache,y)];case 3:I.sent(),I.label=4;case 4:return s.isValidating=!1,F.delete(m),s.error!==void 0&&(H=!o&&e.shouldRetryOnError&&(l?l.shouldRetryOnError:!0),H&&fe(g,l?l.errorRetryCount:1,e)),[2]}})})},V&&e.revalidateDebounce?(setTimeout(function(){return R(M,void 0,void 0,function(){return E(this,function(w){switch(w.label){case 0:return o?[3,2]:[4,D()];case 1:w.sent(),w.label=2;case 2:return[2]}})})},e.revalidateDebounce),[3,3]):[3,1])):[2];case 1:return[4,D()];case 2:T.sent(),T.label=3;case 3:return[2]}})})},A=function(){return R(r,void 0,void 0,function(){return E(this,function(v){return[2,g(null,{shouldRetryOnError:!1})]})})},p=null;N(function(){var v=function(){return R(r,void 0,void 0,function(){return E(this,function(l){switch(l.label){case 0:return!s.error&&e.isOnline()?[4,g()]:[3,2];case 1:return l.sent(),[3,3];case 2:p&&clearTimeout(p),l.label=3;case 3:return e.refreshInterval&&!o&&(p=setTimeout(v,e.refreshInterval)),[2]}})})};e.refreshInterval&&(p=setTimeout(v,e.refreshInterval)),e.revalidateOnFocus&&(document.addEventListener("visibilitychange",A,!1),window.addEventListener("focus",A,!1))}),Q(function(){o=!0,p&&clearTimeout(p),e.revalidateOnFocus&&(document.removeEventListener("visibilitychange",A,!1),window.removeEventListener("focus",A,!1));var v=O.get(h.value);v&&(v.data=v.data.filter(function(l){return l!==s}))});try{X(h,function(v){Y(h)||(h.value=v),s.key=v,s.isValidating=!!v,oe(h.value,s,y),!f&&!c&&h.value&&g(),c=!1},{immediate:!0})}catch{}var G=b(b({},Z(s)),{mutate:function(v,l){return g(v,b(b({},l),{forceRevalidate:!0}))}});return G}function le(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}export{ce as u};
